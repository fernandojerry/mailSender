const nodemailer = require('nodemailer');

module.exports = async (req, res) => {
  const { email, subject, logoUrl, amount, date } = req.body;

  const transporter = nodemailer.createTransport({
    host: process.env.SMTP_HOST,
    port: process.env.SMTP_PORT,
    secure: process.env.SMTP_SECURE === 'true', // true for port 465, false for other ports
    auth: {
      user: process.env.SMTP_USER,
      pass: process.env.SMTP_PASS,
    },
  });

  const mailOptions = {
    from: process.env.SMTP_USER,
    to: email,
    subject: subject,
    html: `
      <div style="font-family: Arial, sans-serif; text-align: center;">
        <img src="${logoUrl}" alt="Logo" style="max-width: 200px; margin-bottom: 20px;" />
        <h2>Transaction Successful</h2>
        <p>Amount: $${amount}</p>
        <p>Date: ${date}</p>
        <p>Your transaction was successful!</p>
      </div>
    `,
  };

  try {
    await transporter.sendMail(mailOptions);
    res.status(200).json({ success: true });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
};
